<!-- 
    Visualforce page that embeds a Hex data visualization app
    - Uses Account standard controller to access Account record data
    - Removes Salesforce UI elements (header, sidebar, stylesheets) for clean embedding
-->
<apex:page standardController="Account" showHeader="false" sidebar="false" standardStylesheets="false">
    <html>
        <head>
            <title>Hex Revenue Data App</title>
            <style>
                /* Reset all default margins and padding for consistent display */
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                /* Make html and body fill entire viewport with no scrolling */
                html, body {
                    height: 100%;
                    overflow: hidden;
                }
                
                /* Container for the embedded iframe - fixed height for consistent display */
                .embed-container {
                    position: relative;
                    width: 100%;
                    height: 1200px;        /* Fixed height for the embedded content */
                    min-height: 1200px;    /* Ensures minimum height is maintained */
                }
                
                /* Styling for the iframe that contains the Hex app */
                .embed-frame {
                    width: 100%;
                    height: 100%;
                    border: none;          /* Remove default iframe border */
                    display: block;
                }
                
                /* Hex branding logo positioned at bottom-right corner */
                .hex-logo {
                    position: absolute;
                    bottom: 10px;
                    right: 10px;
                    z-index: 1000;        /* Ensure logo appears above iframe content */
                    opacity: 0.7;         /* Semi-transparent for subtle branding */
                }
                
                /* Size the logo image appropriately */
                .hex-logo img {
                    height: 20px;
                    width: auto;          /* Maintain aspect ratio */
                }
            </style>
        </head>
        <body>
            <!-- Main container for the embedded Hex application -->
            <div class="embed-container">
                <!-- 
                    Iframe that will load the Hex data visualization app
                    - allowfullscreen: Permits fullscreen mode if needed
                    - loading="lazy": Delays loading until iframe is visible
                    - allow="storage-access-api": Permits storage access for app functionality
                    - sandbox: Security restrictions allowing necessary features while maintaining safety
                -->
                <iframe id="hexFrame" 
                        class="embed-frame"
                        allowfullscreen="true"
                        loading="lazy"
                        allow="storage-access-api"
                        sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
                </iframe>
                
                <!-- Hex branding link - opens in new tab when clicked -->
                <a href="https://hex.tech/?embed" target="_blank" class="hex-logo">
                    <img src="https://static.hex.site/embed/hex-logo-embed.png" alt="Hex - a modern data workspace"/>
                </a>
            </div>
            
            <script>
                // Get the Account Name from the Salesforce record using Visualforce expression
                // JSENCODE prevents XSS attacks by properly encoding the account name
                var accountName = '{!JSENCODE(Account.Name)}';
                
                // Base URL for the Hex application (specific app ID in the URL)
                var baseUrl = 'https://app.hex.tech/hex-demo/app/0196cf2a-e769-733d-a7f0-7b31132ba1f7/latest';
                
                // Construct the full URL with query parameters:
                // - _account_name: Pass the Salesforce account name to the Hex app
                // - embedded=true: Tell Hex this is an embedded context
                var url = baseUrl + '?_account_name="' + accountName + '"&embedded=true';
                
                // Log the generated URL for debugging purposes
                console.log('Generated URL:', url);
                
                // Set the iframe source to load the Hex app with the constructed URL
                document.getElementById('hexFrame').src = url;
            </script>
        </body>
    </html>
</apex:page>
